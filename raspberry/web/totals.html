<!doctype html>
<html lang="en">

<head>
  <link rel="stylesheet" href="css/pure-min.css">
  <link rel="stylesheet" href="css/layouts/side-menu.css">
  <script src="js/plotly.min.js"></script>
</head>

<body>
  <div id="layout">
      <!-- Menu toggle -->
      <a href="#menu" id="menuLink" class="menu-link">
          <!-- Hamburger icon -->
          <span></span>
      </a>

      <div id="menu">
          <div class="pure-menu">
              <a class="pure-menu-heading" href="#">Meter</a>

              <ul class="pure-menu-list">
                  <li class="pure-menu-item"><a href="index.html" class="pure-menu-link">Real-time</a></li>
                  <li class="pure-menu-item"><a href="totals.html" class="pure-menu-link">Totals</a></li>
                  <li class="pure-menu-item"><a href="#" class="pure-menu-link">Config</a></li>
              </ul>
          </div>
      </div>
      <div id="main">
          <div id="myDiv"><!-- Plotly chart will be drawn inside this DIV --></div>
      </div>
  <script>
var stacksDiv = document.getElementById("myDiv");

function stackedArea() {
    var traces = []
    for(var i=0; i<7; i++) {
        var request_rms = new XMLHttpRequest();
        request_rms.open("GET", "rms_values_" + i +".csv", false);
        request_rms.send(null);
        var data = request_rms.responseText.split("\n")
        var power = []
        var date = []
        for (var line in data) {
            if (!data[line])
                break;
            var values = data[line].split(",")
            if (i>0) {
                power.push(traces[i-1]['y'][power.length] + values[1]*values[2])
            } else {
                power.push(values[1]*values[2])
            }
            var time = new Date()
            time.setTime(values[0]*1000)
            date.push(time)
        }
        traces[i] = {'name': 'Channel ' + i,'y': power, 'x': date, fill: 'tozeroy'}
    }
    return traces.reverse();
}
var layout = {
    title: 'Sum of all channels power',
    xaxis: {
        title: 'Date'
    },
    yaxis: {
        title: 'Power'
    }
}

Plotly.newPlot(stacksDiv, stackedArea(), layout);
  </script>
  </div>
<script type="text/javascript" src="js/ui.js"></script>
</body>
</html>
